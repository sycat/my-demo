name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: workflow_dispatch
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-20.04
    env:
      Repo_Name: ${{ github.event.repository.name }}
      # Key_Path: ~/aws_ec2_key.pem
      # Ssh_Destination: ubuntu@ec2-54-188-83-98.us-west-2.compute.amazonaws.com
      Ec2_Host: ec2-54-188-83-98.us-west-2.compute.amazonaws.com
    permissions:
      checks: write
    steps:
      # - name: Save Ec2 private key
      #   run: |
      #     echo "${{ secrets.AWS_EC2_INSTANCE_SSH_PRIVATE_KEY }}" >> ${{ env.Key_Path }}
      #     chmod 400 ${{ env.Key_Path }}
      - name: Save ssh config
        run: |
          mkdir -p ~/.ssh/
          echo "${{ secrets.AWS_EC2_INSTANCE_SSH_PRIVATE_KEY }}" > ~/.ssh/aws_ec2.key
          chmod 400 ~/.ssh/aws_ec2.key
          cat >>~/.ssh/config <<EOF
            Host *
              # HostName ${{ env.Ec2_Host }}
              User ubuntu
              IdentityFile ~/.ssh/aws_ec2.key
              # Port 80
              StrictHostKeyChecking no
              RequestTTY yes
          EOF

      - name: run testing
        run: |
          ssh ${{ env.Ec2_Host }} <<EOF
            cd ~
            pwd
            echo "${{ env.Repo_Name }}"
          EOF

      - name: run scp
        run: |
          scp -T -r ${{ github.workspace }} ${{ env.Ec2_Host }}:~/test_scp/

      - run: echo "🍏 This job's status is ${{ job.status }}."