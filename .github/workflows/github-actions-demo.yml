name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: workflow_dispatch
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-20.04
    permissions:
      checks: write
    steps:
      - uses: actions/checkout@v3

      - name: Deploy to ec2
        uses: easingthemes/ssh-deploy@main
        env:
          SSH_PRIVATE_KEY: ${{ secrets.AWS_EC2_INSTANCE_SSH_PRIVATE_KEY }}
          SSH_CMD_ARGS: "-o StrictHostKeyChecking=no"
          REMOTE_HOST: ec2-18-237-84-202.us-west-2.compute.amazonaws.com
          REMOTE_USER: ec2-user
          ARGS: "-rlgoDzvc -i"
          SOURCE: ""
          TARGET: /home/ec2-user/my-demo/
          EXCLUDE: ".git/, .github/"
          SCRIPT_BEFORE: |
            whoami
          SCRIPT_AFTER: |
            whoami
            ls -al
            echo $RSYNC_STDOUT
            cd my-demo
            sh ./run_e2e_testing.sh

      # - name: Upload test result
      #   if: ${{ always() }}
      #   uses: actions/upload-artifact@v3
      #   with:
      #     name: test-report
      #     path: outputs/
      #     retention-days: 30
      # - name: Test Report
      #   uses: dorny/test-reporter@v1
      #   if: success() || failure()    # run this step even if previous step failed
      #   with:
      #     name: Pytest Tests            # Name of the check run which will be created
      #     path: outputs/test_report.xml    # Path to test results
      #     reporter: java-junit        # Format of test results

      - run: echo "üçè This job's status is ${{ job.status }}."